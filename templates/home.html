{# è¦ç¹¼æ‰¿çš„æ¨¡æ¿ #}
{% extends "./layouts/base.html" %}

<!--
{# è¨­ç½®ç¶²é çš„logo 
{% block Web_Icon %}https://{% endblock Web_Icon %}
#}
-->

{% block Head %}
{# å› ä½¿ç”¨block Headå€å¡Šç¹¼æ‰¿ï¼Œæ‰€ä»¥é ˆä½¿ç”¨super()ç¹¼æ‰¿æ¨¡æ¿çš„å…§å®¹ï¼Œå¦‚æœæ²’æœ‰åŠ super()ï¼Œåªæœƒç•™ä¸‹å¦‚ä¸‹æ–¹çš„style #}
{{ super() }}
{% endblock Head %}

{# è¨­ç½®ç¶²é æ¨™é¡Œ #}
{% block Title %}ç¾Šéš»è¾¨è­˜ç¶²é {% endblock Title%}

{# è¨­ç½®ç¶²é CSS #}
{% block CSS %}
{# super(): ç¹¼æ‰¿åŸæœ¬æ¨¡æ¿è¨­å®šçš„ #}
{{ super() }}

<!-- Custom Style (è‡ªè¨‚çš„CSSï¼Œåªéœ€æ›´æ”¹filename)-->
<link rel="stylesheet" href="{{ url_for('static', filename='./css/home.css') }}" defer>
{% endblock CSS %}


{# ç¶²é ä¸»å€å¡Š #}
{% block Outer_Main %}
<main id="Main" class="row d-flex justify-content-center glass_morphism border border-3 border-primary-subtle rounded rounded-4">
    {% block Main %}
    <!-- ä¸»å€å¡Šæ¨™é¡Œ -->
    <div class="col-12 pb-4 align-content-center">
        <figure class="text-center">
            <blockquote class="blockquote">
                <p class="display-1">YOLOç¾Šåœˆç®¡ç†ğŸ‘</p>
            </blockquote>
            <figcaption class="blockquote-footer fs-2">
                <span id="Auto_write"></span>
            </figcaption>
        </figure>
    </div>

    <!-- ä¸»å€å¡Šå…§å®¹ -->
    <div class="col-12 p-2">
        <div class="row g-5 justify-content-evenly m-0">
            <!-- å·¦(ä¸Šå‚³å€) -->
            <div id="pre-left" class="col-11 col-sm-9 col-lg-8 col-xl-5 border border-3 bg-success bg-opacity-25 p-5 rounded rounded-4">
                <div class="row gy-3 d-flex justify-content-center">
                    <p id="pre-left-title" class="fw-bold fs-1 text-center">ä¸Šå‚³åœ–ç‰‡æˆ–å½±ç‰‡</p>

                    <form action="{{ url_for('upload_file') }}" method="POST" enctype="multipart/form-data">
                        <div class="input-group">
                            <input type="file" name="file" class="fs-4 form-control" id="fileInput" aria-describedby="inputGroupFileAddon04" aria-label="Upload" accept="image/*,video/*" required>
                            <button class="btn btn-secondary fs-4" type="submit" id="inputGroupFileAddon04" onclick="uploadFile()">ç¢ºèª</button>
                        </div>
                    </form>

                    {% if file_info %}
                        {% if file_info['type'] == "image" %}
                            <div class="img_container d-flex justify-content-center">
                                <img id="previewImage" src="{{ file_info['path'] }}"/>
                            </div>
                        {% elif file_info['type'] == "video" %}
                            <video id="previewVideo" src="{{ file_info['path'] }}" controls></video>
                        {% else %}
                            <script>
                                show_toast("è«‹ä¸Šå‚³æ­£ç¢ºçš„æª”æ¡ˆé¡å‹(åœ–åƒã€å½±ç‰‡)!", 'warning');
                            </script>
                        {% endif %}
                    {% endif %}
                </div>
            </div>

            <!-- å³(è¾¨è­˜çµæœ) -->
            <div id="pre-right" class="col-11 col-sm-9 col-lg-8 col-xl-5 border border-3 bg-danger bg-opacity-10 p-5 rounded rounded-4">
                <div class="row gy-3 d-flex justify-content-center">
                    <p id="pre-right-title" class="fw-bold fs-1 text-center">é æ¸¬çµæœ</p>

                    <button type="button" class="col-12 col-sm-8 col-md-6 btn btn-outline-primary btn fw-bold fs-3 border border-primary border-3" onclick="recognize()">é–‹å§‹è¾¨è­˜</button>

                    <div class="img_container d-flex justify-content-center">
                        <div id="result"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endblock Main %}
</main>
{% endblock Outer_Main %}


{# ç¶²é è…³å°¾ #}
{% block Outer_Footer %}
<footer id="Footer" class="row d-flex glass_morphism justify-content-around gy-3 border border-3 border-warning-subtle rounded rounded-4">
    {% block Footer %}
    <div class="col-12 col-md-6 border border-3 border-dark d-flex justify-content-center m-sm-0 bg-dark-subtle rounded rounded-4" >
        <p class="fw-bold fs-2 m-3">æœ€å¾Œä¿®æ”¹: 2024-01-11</p>
    </div>
    {% endblock Footer %}
</footer>
{% endblock Outer_Footer %}


{# ç¶²é JS #}
{% block JS %}
{# super(): ç¹¼æ‰¿åŸæœ¬æ¨¡æ¿è¨­å®šçš„ #}
{{ super() }}

<script>
    function uploadFile() {
        var fileInput = document.getElementById('fileInput');
        var previewImage = document.getElementById('previewImage');
        var previewVideo = document.getElementById('previewVideo');
        var resultContainer = document.getElementById('result');

        var file = fileInput.files[0];

        if (file) {
            var reader = new FileReader();

            reader.onload = function(e) {
                if (file.type.startsWith('image')) {
                    previewImage.src = e.target.result;
                    previewVideo.style.display = 'none';
                    previewImage.style.display = 'block';
                } else if (file.type.startsWith('video')) {
                    previewVideo.src = e.target.result;
                    previewImage.style.display = 'none';
                    previewVideo.style.display = 'block';
                }
            };

            reader.readAsDataURL(file);

            has_upload = true
        }else{
            show_toast("è«‹ä¸Šå‚³æª”æ¡ˆ!", 'warning');
        }
    }

    function recognize() {
        var resultContainer = document.getElementById('result');
        var previewImage = document.getElementById('previewImage');
        var previewVideo = document.getElementById('previewVideo');

        // é€™è£¡çš„ç¤ºç¯„åƒ…å°‡å·¦é‚Šçš„å…§å®¹è¤‡è£½åˆ°å³é‚Š
        if (previewImage.style.display === 'block') {
            resultContainer.innerHTML = '<img src="' + previewImage.src + '" />';
        } else if (previewVideo.style.display === 'block') {
            resultContainer.innerHTML = '<video src="' + previewVideo.src + '" controls></video>';
        }
    }
</script>

<script>
    // è‡ªå‹•æ‰“å­—
    auto_write(
        tag = "#Auto_write", // è¦å¯«å…¥çš„HTMLæ¨™ç±¤IDæˆ–Class
        msgs = [
            "ä½¿ç”¨é«˜æ•ˆåˆæº–ç¢ºçš„<cite title='Source Title' class='text-success fw-bold'> YOLO-NAS </cite>æ¨¡å‹è¾¨è­˜",
            "<cite title='Source Title' class='text-success fw-bold'>^300ç²¾æº–è¾¨è­˜ç¾Šéš»ID</cite>",
            "<cite title='Source Title' class='text-info fw-bold'>^500ç²¾æº–è¾¨è­˜æ´»å‹•é‡</cite>"
        ], // è£¡é¢æœ‰^1000ã€^500æ˜¯å»¶é²çš„ç§’æ•¸(æ¯«ç§’)
        {
            speed: 70, // æ‰“å­—é€Ÿåº¦
            del_speed: 60, // åˆªé™¤é€Ÿåº¦
            delay: 1200, // å»¶é²é–‹å§‹
            del_delay: 3000, // å»¶é²åˆªé™¤
            cursor_style: "ğŸ‘", // æ¸¸æ¨™æ¨£å¼
            smart_del: true, // é è¨­ï¼Œæ™ºæ…§åˆªé™¤åŠŸèƒ½(åªåˆªé™¤å­—ä¸²ä¸ç›¸åŒçš„éƒ¨åˆ†)
            loop: true // ä¸æ–·é‡è¤‡
        }
    )

    // å½ˆå‡ºæç¤ºæ¡†
    //show_toast("æ¸¬è©¦", 'tip');
</script>
{% endblock JS %}